{
	"name": "ADF_IGM2323001_DW_Load_medidata_ch_fact",
	"properties": {
		"description": "Dataflow to implement SCD Type 2 for Medidata CH Fact Table",
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "DS_AzureSQL",
						"type": "DatasetReference"
					},
					"name": "sourceRaw"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "DS_AzureSQL",
						"type": "DatasetReference"
					},
					"name": "InsertNewData"
				}
			],
			"transformations": [
				{
					"name": "deriveDateColumns"
				}
			],
			"scriptLines": [
				"source(output(",
				"          project as string,",
				"          study_id as string,",
				"          subject as string,",
				"          site as string,",
				"          site_number as string,",
				"          site_group as string,",
				"          instance_name as string,",
				"          instance_repeat_number as string,",
				"          folder_name as string,",
				"          data_page_name as string,",
				"          record_position as string,",
				"          save_ts as string,",
				"          study_env_site_number as string,",
				"          chperf as string,",
				"          chperf_std as string,",
				"          chdat as string,",
				"          chdat_raw as string,",
				"          chdat_int as string,",
				"          chdat_yyyy as string,",
				"          chdat_mm as string,",
				"          chdat_dd as string,",
				"          chage as string,",
				"          chage_raw as string,",
				"          chna as string,",
				"          chna_raw as string,",
				"          chna_un as string,",
				"          chk as string,",
				"          chk_raw as string,",
				"          chk_un as string,",
				"          chcl as string,",
				"          chcl_raw as string,",
				"          chcl_un as string,",
				"          chco2 as string,",
				"          chco2_raw as string,",
				"          chco2_un as string,",
				"          chbun as string,",
				"          chbun_raw as string,",
				"          chbun_un as string,",
				"          chcre as string,",
				"          chcre_raw as string,",
				"          chcre_un as string,",
				"          chgl as string,",
				"          chgl_raw as string,",
				"          chgl_un as string,",
				"          chca as string,",
				"          chca_raw as string,",
				"          chca_un as string,",
				"          chph as string,",
				"          chph_raw as string,",
				"          chph_un as string,",
				"          chmg as string,",
				"          chmg_raw as string,",
				"          chmg_un as string,",
				"          chua as string,",
				"          chua_raw as string,",
				"          chua_un as string,",
				"          chldh as string,",
				"          chldh_raw as string,",
				"          chldh_un as string,",
				"          chalb as string,",
				"          chalb_raw as string,",
				"          chalb_un as string,",
				"          chtp as string,",
				"          chtp_raw as string,",
				"          chtp_un as string,",
				"          chbld as string,",
				"          chbld_raw as string,",
				"          chbld_un as string,",
				"          chblt as string,",
				"          chblt_raw as string,",
				"          chblt_un as string,",
				"          chalk as string,",
				"          chalk_raw as string,",
				"          chalk_un as string,",
				"          chalt as string,",
				"          chalt_raw as string,",
				"          chalt_un as string,",
				"          chast as string,",
				"          chast_raw as string,",
				"          chast_un as string,",
				"          chtim as string,",
				"          chdtm as string,",
				"          chdtm_raw as string,",
				"          chdtm_int as string,",
				"          chdtm_yyyy as string,",
				"          chdtm_mm as string,",
				"          chdtm_dd as string,",
				"          file_name as string,",
				"          load_date as timestamp",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table',",
				"     staged: true) ~> sourceRaw",
				"sourceRaw derive(eff_start_date = currentUTC('PST'),",
				"          eff_end_date = toDate('9999-12-31'),",
				"          created_date = currentUTC('PST'),",
				"          last_updated_date = currentUTC('PST'),",
				"          save_ts = toTimestamp(save_ts, 'M/d/yyyy h:mm:ss a'),",
				"          chdat = toTimestamp(chdat,'M/d/yyyy hh:mm:ss a'),",
				"          chdat_raw = toDate(chdat_raw,'dd MMM yyyy'),",
				"          chdat_int = toTimestamp(chdat_int,'M/d/yyyy h:m:s a'),",
				"          chdtm = toTimestamp(chdtm,'M/d/yyyy hh:mm:ss a'),",
				"          chdtm_raw = toTimestamp(chdtm_raw,'dd MMM yyyy HH:mm'),",
				"          chdtm_int = toTimestamp(chdtm_int,'M/d/yyyy hh:mm:ss a')) ~> deriveDateColumns",
				"deriveDateColumns sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     truncate:true,",
				"     format: 'table',",
				"     staged: true,",
				"     allowCopyCommand: true,",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     saveOrder: 1,",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          project,",
				"          study_id,",
				"          subject,",
				"          site,",
				"          site_number,",
				"          site_group,",
				"          instance_name,",
				"          instance_repeat_number,",
				"          folder_name,",
				"          data_page_name,",
				"          record_position,",
				"          save_ts,",
				"          study_env_site_number,",
				"          chperf,",
				"          chperf_std,",
				"          chdat,",
				"          chdat_raw,",
				"          chdat_int,",
				"          chdat_yyyy,",
				"          chdat_mm,",
				"          chdat_dd,",
				"          chage,",
				"          chage_raw,",
				"          chna,",
				"          chna_raw,",
				"          chna_un,",
				"          chk,",
				"          chk_raw,",
				"          chk_un,",
				"          chcl,",
				"          chcl_raw,",
				"          chcl_un,",
				"          chco2,",
				"          chco2_raw,",
				"          chco2_un,",
				"          chbun,",
				"          chbun_raw,",
				"          chbun_un,",
				"          chcre,",
				"          chcre_raw,",
				"          chcre_un,",
				"          chgl,",
				"          chgl_raw,",
				"          chgl_un,",
				"          chca,",
				"          chca_raw,",
				"          chca_un,",
				"          chph,",
				"          chph_raw,",
				"          chph_un,",
				"          chmg,",
				"          chmg_raw,",
				"          chmg_un,",
				"          chua,",
				"          chua_raw,",
				"          chua_un,",
				"          chldh,",
				"          chldh_raw,",
				"          chldh_un,",
				"          chalb,",
				"          chalb_raw,",
				"          chalb_un,",
				"          chtp,",
				"          chtp_raw,",
				"          chtp_un,",
				"          chbld,",
				"          chbld_raw,",
				"          chbld_un,",
				"          chblt,",
				"          chblt_raw,",
				"          chblt_un,",
				"          chalk,",
				"          chalk_raw,",
				"          chalk_un,",
				"          chalt,",
				"          chalt_raw,",
				"          chalt_un,",
				"          chast,",
				"          chast_raw,",
				"          chast_un,",
				"          chtim,",
				"          chdtm,",
				"          chdtm_raw,",
				"          chdtm_int,",
				"          chdtm_yyyy,",
				"          chdtm_mm,",
				"          chdtm_dd,",
				"          file_name,",
				"          eff_start_date,",
				"          eff_end_date,",
				"          created_date,",
				"          last_updated_date",
				"     )) ~> InsertNewData"
			]
		}
	}
}