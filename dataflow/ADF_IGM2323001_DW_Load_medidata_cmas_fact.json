{
	"name": "ADF_IGM2323001_DW_Load_medidata_cmas_fact",
	"properties": {
		"description": "Dataflow to implement SCD Type 2 for Medidata CMAS Fact Table",
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "DS_AzureSQL",
						"type": "DatasetReference"
					},
					"name": "sourceRaw"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "DS_AzureSQL",
						"type": "DatasetReference"
					},
					"name": "InsertNewData"
				}
			],
			"transformations": [
				{
					"name": "deriveDateColumns"
				}
			],
			"scriptLines": [
				"source(output(",
				"          project as string,",
				"          study_id as string,",
				"          subject as string,",
				"          site as string,",
				"          site_number as string,",
				"          site_group as string,",
				"          instance_name as string,",
				"          instance_repeat_number as string,",
				"          folder_name as string,",
				"          datapage_name as string,",
				"          record_position as string,",
				"          save_ts as string,",
				"          study_env_site_number as string,",
				"          cmasperf as string,",
				"          cmasperf_std as string,",
				"          cmasrsp as string,",
				"          cmastpt as string,",
				"          cmastpt_std as string,",
				"          cmasdat as string,",
				"          cmasdat_raw as string,",
				"          cmasdat_int as string,",
				"          cmasdat_yyyy as string,",
				"          cmasdat_mm as string,",
				"          cmasdat_dd as string,",
				"          cmastim as string,",
				"          cmasc1q as string,",
				"          cmasc1q_raw as string,",
				"          cmasc3 as string,",
				"          cmasc3_raw as string,",
				"          cmasc35a as string,",
				"          cmasc35a_raw as string,",
				"          cmasc4 as string,",
				"          cmasc4_raw as string,",
				"          cmasch50 as string,",
				"          cmasch50_raw as string,",
				"          cmasdtm as string,",
				"          cmasdtm_raw as string,",
				"          cmasdtm_int as string,",
				"          cmasdtm_yyyy as string,",
				"          cmasdtm_mm as string,",
				"          cmasdtm_dd as string,",
				"          cmasnow as string,",
				"          cmasnow_raw as string,",
				"          cmasnow_int as string,",
				"          cmasnow_yyyy as string,",
				"          cmasnow_mm as string,",
				"          cmasnow_dd as string,",
				"          cmascc3a as string,",
				"          cmascc3a_raw as string,",
				"          cmasc5a as string,",
				"          cmasc5a_raw as string,",
				"          cmas50eq as string,",
				"          cmas50eq_std as string,",
				"          cmasc1qu as string,",
				"          cmasc1qu_std as string,",
				"          cmasc1qo as string,",
				"          cmasc3u as string,",
				"          cmasc3u_std as string,",
				"          cmasc3o as string,",
				"          cmasc3au as string,",
				"          cmasc3au_std as string,",
				"          cmasc3ao as string,",
				"          cmasc5au as string,",
				"          cmasc5au_std as string,",
				"          cmasc5ao as string,",
				"          cmasc4u as string,",
				"          cmasc4u_std as string,",
				"          cmasc4o as string,",
				"          cmas50u as string,",
				"          cmas50u_std as string,",
				"          cmas50ou as string,",
				"          cmasc1eq as string,",
				"          cmasc1eq_std as string,",
				"          cmasc3eq as string,",
				"          cmasc3eq_std as string,",
				"          cmasc3aeq as string,",
				"          cmasc3aeq_std as string,",
				"          cmasc5aeq as string,",
				"          cmasc5aeq_std as string,",
				"          cmasc4eq as string,",
				"          cmasc4eq_std as string,",
				"          file_name as string,",
				"          load_date as timestamp",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table',",
				"     staged: true) ~> sourceRaw",
				"sourceRaw derive(eff_start_date = currentUTC('PST'),",
				"          eff_end_date = toDate('9999-12-31'),",
				"          created_date = currentUTC('PST'),",
				"          last_updated_date = currentUTC('PST'),",
				"          save_ts = toTimestamp(save_ts, 'M/d/yyyy h:mm:ss a'),",
				"          cmasdat = toTimestamp(cmasdat,'M/d/yyyy hh:mm:ss a'),",
				"          cmasdat_raw = toDate(cmasdat_raw,'dd MMM yyyy'),",
				"          cmasdat_int = toTimestamp(cmasdat_int,'M/d/yyyy h:m:s a'),",
				"          cmasdtm = toTimestamp(cmasdtm,'M/d/yyyy hh:mm:ss a'),",
				"          cmasdtm_raw = toTimestamp(cmasdtm_raw,'dd MMM yyyy HH:mm'),",
				"          cmasdtm_int = toTimestamp(cmasdtm_int,'M/d/yyyy hh:mm:ss a'),",
				"          cmasnow = toTimestamp(cmasnow,'M/d/yyyy hh:mm:ss a'),",
				"          cmasnow_raw = toTimestamp(cmasnow_raw,'dd MMM yyyy HH:mm'),",
				"          cmasnow_int = toTimestamp(cmasnow_int,'M/d/yyyy hh:mm:ss a')) ~> deriveDateColumns",
				"deriveDateColumns sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     truncate:true,",
				"     format: 'table',",
				"     staged: true,",
				"     allowCopyCommand: true,",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     saveOrder: 1,",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          project,",
				"          study_id,",
				"          subject,",
				"          site,",
				"          site_number,",
				"          site_group,",
				"          instance_name,",
				"          instance_repeat_number,",
				"          folder_name,",
				"          datapage_name,",
				"          record_position,",
				"          save_ts,",
				"          study_env_site_number,",
				"          cmasperf,",
				"          cmasperf_std,",
				"          cmasrsp,",
				"          cmastpt,",
				"          cmastpt_std,",
				"          cmasdat,",
				"          cmasdat_raw,",
				"          cmasdat_int,",
				"          cmasdat_yyyy,",
				"          cmasdat_mm,",
				"          cmasdat_dd,",
				"          cmastim,",
				"          cmasc1q,",
				"          cmasc1q_raw,",
				"          cmasc3,",
				"          cmasc3_raw,",
				"          cmasc35a,",
				"          cmasc35a_raw,",
				"          cmasc4,",
				"          cmasc4_raw,",
				"          cmasch50,",
				"          cmasch50_raw,",
				"          cmasdtm,",
				"          cmasdtm_raw,",
				"          cmasdtm_int,",
				"          cmasdtm_yyyy,",
				"          cmasdtm_mm,",
				"          cmasdtm_dd,",
				"          cmasnow,",
				"          cmasnow_raw,",
				"          cmasnow_int,",
				"          cmasnow_yyyy,",
				"          cmasnow_mm,",
				"          cmasnow_dd,",
				"          cmascc3a,",
				"          cmascc3a_raw,",
				"          cmasc5a,",
				"          cmasc5a_raw,",
				"          cmas50eq,",
				"          cmas50eq_std,",
				"          cmasc1qu,",
				"          cmasc1qu_std,",
				"          cmasc1qo,",
				"          cmasc3u,",
				"          cmasc3u_std,",
				"          cmasc3o,",
				"          cmasc3au,",
				"          cmasc3au_std,",
				"          cmasc3ao,",
				"          cmasc5au,",
				"          cmasc5au_std,",
				"          cmasc5ao,",
				"          cmasc4u,",
				"          cmasc4u_std,",
				"          cmasc4o,",
				"          cmas50u,",
				"          cmas50u_std,",
				"          cmas50ou,",
				"          cmasc1eq,",
				"          cmasc1eq_std,",
				"          cmasc3eq,",
				"          cmasc3eq_std,",
				"          cmasc3aeq,",
				"          cmasc3aeq_std,",
				"          cmasc5aeq,",
				"          cmasc5aeq_std,",
				"          cmasc4eq,",
				"          cmasc4eq_std,",
				"          file_name,",
				"          eff_start_date,",
				"          eff_end_date,",
				"          created_date,",
				"          last_updated_date",
				"     )) ~> InsertNewData"
			]
		}
	}
}