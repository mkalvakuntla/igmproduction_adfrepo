{
	"name": "ADF_IGM2323001_DW_Load_medidata_ltl_fact",
	"properties": {
		"description": "Dataflow to implement SCD Type 2 for Medidata LTL Fact Table",
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "DS_AzureSQL",
						"type": "DatasetReference"
					},
					"name": "sourceRaw"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "DS_AzureSQL",
						"type": "DatasetReference"
					},
					"name": "InsertNewData"
				}
			],
			"transformations": [
				{
					"name": "deriveDateColumns"
				}
			],
			"scriptLines": [
				"source(output(",
				"          project as string,",
				"          study_id as string,",
				"          subject as string,",
				"          site as string,",
				"          site_number as string,",
				"          site_group as string,",
				"          instance_name as string,",
				"          instance_repeat_number as string,",
				"          folder_name as string,",
				"          data_page_name as string,",
				"          record_position as string,",
				"          save_ts as string,",
				"          study_env_site_number as string,",
				"          ltlspid as string,",
				"          ltlspid_std as string,",
				"          ltlsite as string,",
				"          ltlsite_std as string,",
				"          ltlsitos as string,",
				"          ltlloc as string,",
				"          ltltpt as string,",
				"          ltltpt_std as string,",
				"          ltlacn as string,",
				"          ltlacn_raw as string,",
				"          ltlaspid as string,",
				"          ltlaspid_raw as string,",
				"          ltlaperf as string,",
				"          ltlaperf_std as string,",
				"          ltladt as string,",
				"          ltladt_raw as string,",
				"          ltladt_int as string,",
				"          ltladt_yyyy as string,",
				"          ltladt_mm as string,",
				"          ltladt_dd as string,",
				"          ltlatim as string,",
				"          ltladtm as string,",
				"          ltladtm_raw as string,",
				"          ltladtm_int as string,",
				"          ltladtm_yyyy as string,",
				"          ltladtm_mm as string,",
				"          ltladtm_dd as string,",
				"          ltldc as string,",
				"          ltldc_std as string,",
				"          ltlamd as string,",
				"          ltlamd_std as string,",
				"          ltlamdos as string,",
				"          ltlimgq as string,",
				"          ltlimgq_std as string,",
				"          ltlimqs as string,",
				"          ltlastat as string,",
				"          ltlastat_std as string,",
				"          ltlasplt as string,",
				"          ltlasplt_std as string,",
				"          ltlamrg as string,",
				"          ltlamrg_std as string,",
				"          ltlarslt as string,",
				"          ltlarslt_std as string,",
				"          ltlald as string,",
				"          ltlald_raw as string,",
				"          ltlasa as string,",
				"          ltlasa_raw as string,",
				"          ltladd as string,",
				"          ltladd_std as string,",
				"          ltlnow as string,",
				"          ltlnow_raw as string,",
				"          ltlnow_int as string,",
				"          ltlnow_yyyy as string,",
				"          ltlnow_mm as string,",
				"          ltlnow_dd as string,",
				"          file_name as string,",
				"          load_date as timestamp",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table',",
				"     staged: true) ~> sourceRaw",
				"sourceRaw derive(eff_start_date = currentUTC('PST'),",
				"          eff_end_date = toDate('9999-12-31'),",
				"          created_date = currentUTC('PST'),",
				"          last_updated_date = currentUTC('PST'),",
				"          save_ts = toTimestamp(save_ts, 'M/d/yyyy h:mm:ss a'),",
				"          ltladt = toTimestamp(ltladt,'M/d/yyyy hh:mm:ss a'),",
				"          ltladt_raw = toDate(ltladt_raw,'dd MMM yyyy'),",
				"          ltladt_int = toTimestamp(ltladt_int,'M/d/yyyy h:m:s a'),",
				"          ltladtm = toTimestamp(ltladtm,'M/d/yyyy hh:mm:ss a'),",
				"          ltladtm_raw = toTimestamp(ltladtm_raw,'dd MMM yyyy HH:mm'),",
				"          ltladtm_int = toTimestamp(ltladtm_int,'M/d/yyyy hh:mm:ss a'),",
				"          ltlnow = toTimestamp(ltlnow,'M/d/yyyy hh:mm:ss a'),",
				"          ltlnow_raw = toTimestamp(ltlnow_raw,'dd MMM yyyy HH:mm'),",
				"          ltlnow_int = toTimestamp(ltlnow_int,'M/d/yyyy hh:mm:ss a')) ~> deriveDateColumns",
				"deriveDateColumns sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     truncate:true,",
				"     format: 'table',",
				"     staged: true,",
				"     allowCopyCommand: true,",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     saveOrder: 1,",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          project,",
				"          study_id,",
				"          subject,",
				"          site,",
				"          site_number,",
				"          site_group,",
				"          instance_name,",
				"          instance_repeat_number,",
				"          folder_name,",
				"          data_page_name,",
				"          record_position,",
				"          save_ts,",
				"          study_env_site_number,",
				"          ltlspid,",
				"          ltlspid_std,",
				"          ltlsite,",
				"          ltlsite_std,",
				"          ltlsitos,",
				"          ltlloc,",
				"          ltltpt,",
				"          ltltpt_std,",
				"          ltlacn,",
				"          ltlacn_raw,",
				"          ltlaspid,",
				"          ltlaspid_raw,",
				"          ltlaperf,",
				"          ltlaperf_std,",
				"          ltladt,",
				"          ltladt_raw,",
				"          ltladt_int,",
				"          ltladt_yyyy,",
				"          ltladt_mm,",
				"          ltladt_dd,",
				"          ltlatim,",
				"          ltladtm,",
				"          ltladtm_raw,",
				"          ltladtm_int,",
				"          ltladtm_yyyy,",
				"          ltladtm_mm,",
				"          ltladtm_dd,",
				"          ltldc,",
				"          ltldc_std,",
				"          ltlamd,",
				"          ltlamd_std,",
				"          ltlamdos,",
				"          ltlimgq,",
				"          ltlimgq_std,",
				"          ltlimqs,",
				"          ltlastat,",
				"          ltlastat_std,",
				"          ltlasplt,",
				"          ltlasplt_std,",
				"          ltlamrg,",
				"          ltlamrg_std,",
				"          ltlarslt,",
				"          ltlarslt_std,",
				"          ltlald,",
				"          ltlald_raw,",
				"          ltlasa,",
				"          ltlasa_raw,",
				"          ltladd,",
				"          ltladd_std,",
				"          ltlnow,",
				"          ltlnow_raw,",
				"          ltlnow_int,",
				"          ltlnow_yyyy,",
				"          ltlnow_mm,",
				"          ltlnow_dd,",
				"          file_name,",
				"          eff_start_date,",
				"          eff_end_date,",
				"          created_date,",
				"          last_updated_date",
				"     )) ~> InsertNewData"
			]
		}
	}
}