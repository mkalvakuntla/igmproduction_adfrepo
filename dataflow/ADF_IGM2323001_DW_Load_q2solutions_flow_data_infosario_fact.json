{
	"name": "ADF_IGM2323001_DW_Load_q2solutions_flow_data_infosario_fact",
	"properties": {
		"description": "Dataflow to implement SCD Type 2 for IGM2323001_ DW_Load_q2solutions_flow_data_infosario fact Table",
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "DS_AzureSQL",
						"type": "DatasetReference"
					},
					"name": "sourceRaw"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "DS_AzureSQL",
						"type": "DatasetReference"
					},
					"name": "InsertNewData"
				}
			],
			"transformations": [
				{
					"name": "deriveDateColumns"
				}
			],
			"scriptLines": [
				"source(output(",
				"          protocol_number as string,",
				"          project_site_number as string,",
				"          project_site_name as string,",
				"          principal_investigator as string,",
				"          subject_identifier_for_the_study as string,",
				"          current_subject_status as string,",
				"          subject_failed_screen_id as string,",
				"          year_of_birth as string,",
				"          age_years as string,",
				"          sex as string,",
				"          specimen_id as string,",
				"          date_time_of_specimen_collection as string,",
				"          visit_date as string,",
				"          visit_time as string,",
				"          kit_received_date as string,",
				"          visit_names as string,",
				"          scheduled_or_unscheduled_visit as string,",
				"          accession_status as string,",
				"          days_to_report as string,",
				"          category_for_lab_test as string,",
				"          lab_test_or_examination_name as string,",
				"          result_or_finding_in_original_units as string,",
				"          original_units as string,",
				"          reference_range_upper_limit_in_original_unit as string,",
				"          reference_range_lower_limit_in_original_unit as string,",
				"          numeric_result_finding_in_standard_units as string,",
				"          standard_units as string,",
				"          reference_range_upper_limit_std_units as string,",
				"          reference_range_lower_limit_std_units as string,",
				"          reference_range_indicator as string,",
				"          character_result_finding_in_std_format as string,",
				"          reference_range_for_char_rslt_std_units as string,",
				"          test_confirmed_date as string,",
				"          earliest_report_date as string,",
				"          uln_range as string,",
				"          uln_ratio as string,",
				"          lln_range as string,",
				"          lln_ratio as string,",
				"          normal_or_abnormal as string,",
				"          exclusion_flag as string,",
				"          delta_flag as string,",
				"          standard_toxicity_grade as string,",
				"          test_comments as string,",
				"          baseline_flag as string,",
				"          reason_test_not_done as string,",
				"          fasting_status as string,",
				"          completion_status as string,",
				"          test_status as string,",
				"          race as string,",
				"          ethnicity as string,",
				"          region as string,",
				"          subregion as string,",
				"          country as string,",
				"          file_name as string,",
				"          load_date as timestamp",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table',",
				"     staged: true) ~> sourceRaw",
				"sourceRaw derive(eff_start_date = currentUTC('PST'),",
				"          eff_end_date = toDate('9999-12-31'),",
				"          created_date = currentUTC('PST'),",
				"          last_updated_date = currentUTC('PST'),",
				"          visit_date = toDate(visit_date, 'yyyy-MM-dd'),",
				"          kit_received_date = toDate(kit_received_date, 'yyyy-MM-dd'),",
				"          test_confirmed_date = toDate(test_confirmed_date,'yyyy-MM-dd'),",
				"          date_time_of_specimen_collection = toTimestamp(replace(date_time_of_specimen_collection,'T',' '),'yyyy-MM-ddHH:mm:ss')) ~> deriveDateColumns",
				"deriveDateColumns sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     truncate:true,",
				"     format: 'table',",
				"     staged: true,",
				"     allowCopyCommand: true,",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     saveOrder: 1,",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          protocol_number,",
				"          project_site_number,",
				"          project_site_name,",
				"          principal_investigator,",
				"          subject_identifier_for_the_study,",
				"          current_subject_status,",
				"          subject_failed_screen_id,",
				"          year_of_birth,",
				"          age_years,",
				"          sex,",
				"          specimen_id,",
				"          date_time_of_specimen_collection,",
				"          visit_date,",
				"          visit_time,",
				"          kit_received_date,",
				"          visit_names,",
				"          scheduled_or_unscheduled_visit,",
				"          accession_status,",
				"          days_to_report,",
				"          category_for_lab_test,",
				"          lab_test_or_examination_name,",
				"          result_or_finding_in_original_units,",
				"          original_units,",
				"          reference_range_upper_limit_in_original_unit,",
				"          reference_range_lower_limit_in_original_unit,",
				"          numeric_result_finding_in_standard_units,",
				"          standard_units,",
				"          reference_range_upper_limit_std_units,",
				"          reference_range_lower_limit_std_units,",
				"          reference_range_indicator,",
				"          character_result_finding_in_std_format,",
				"          reference_range_for_char_rslt_std_units,",
				"          test_confirmed_date,",
				"          earliest_report_date,",
				"          uln_range,",
				"          uln_ratio,",
				"          lln_range,",
				"          lln_ratio,",
				"          normal_or_abnormal,",
				"          exclusion_flag,",
				"          delta_flag,",
				"          standard_toxicity_grade,",
				"          test_comments,",
				"          baseline_flag,",
				"          reason_test_not_done,",
				"          fasting_status,",
				"          completion_status,",
				"          test_status,",
				"          race,",
				"          ethnicity,",
				"          region,",
				"          subregion,",
				"          country,",
				"          file_name,",
				"          eff_start_date,",
				"          eff_end_date,",
				"          created_date,",
				"          last_updated_date",
				"     )) ~> InsertNewData"
			]
		}
	}
}